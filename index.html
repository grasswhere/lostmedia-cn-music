<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音频播放器</title>
    <style>
        :root {
            --player-width: 100%;
            --player-height: auto;
            --border-radius: 8px;
            --control-bg: rgba(255, 255, 255, 0.9);
            --progress-color: #3498db;
            --error-text-color: #e74c3c;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            overflow: hidden;
        }

        .audio-container {
            width: var(--player-width);
            height: var(--player-height);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .audio-error {
            color: var(--error-text-color);
            padding: 10px;
            text-align: center;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
        }

        /* 自定义音频控件样式 */
        audio {
            width: 100%;
            max-width: 600px;
            border-radius: var(--border-radius);
            background-color: var(--control-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* 兼容不同浏览器的音频进度条样式 */
        audio::-webkit-media-controls-panel {
            background-color: var(--control-bg);
            border-radius: var(--border-radius);
        }

        audio::-webkit-media-controls-current-time-display,
        audio::-webkit-media-controls-time-remaining-display {
            color: #333;
        }

        audio::-webkit-media-controls-timeline {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin: 0 10px;
        }

        audio::-webkit-media-controls-volume-slider {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        audio::-webkit-media-controls-play-button {
            color: var(--progress-color);
        }

        audio::-webkit-media-controls-mute-button {
            color: var(--progress-color);
        }
    </style>
</head>
<body>
    <div class="audio-container">
        <audio id="dynamicAudio" controls preload="auto"></audio>
    </div>
    <script>
        // 获取URL参数
        function getUrlParameter(name) {
            const regex = new RegExp('[?&]' + name + '=([^&#]*)');
            const results = regex.exec(window.location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // 设置自定义样式参数
        function applyCustomStyles() {
            const width = getUrlParameter('width');
            const height = getUrlParameter('height');
            const borderRadius = getUrlParameter('radius');
            const bgColor = getUrlParameter('bgcolor');
            const progressColor = getUrlParameter('progress');

            if (width) document.documentElement.style.setProperty('--player-width', width);
            if (height) document.documentElement.style.setProperty('--player-height', height);
            if (borderRadius) document.documentElement.style.setProperty('--border-radius', borderRadius);
            if (bgColor) document.documentElement.style.setProperty('--control-bg', bgColor);
            if (progressColor) document.documentElement.style.setProperty('--progress-color', progressColor);
        }

        // 初始化播放器
        function initPlayer() {
            const url = getUrlParameter('url');
            const page = getUrlParameter('page') || '%%fullname%%';
            const audio = document.getElementById('dynamicAudio');
            const isFullUrl = /^https?:\/\//i.test(url);

            // 构建音频
            if (url) {
                audio.src = isFullUrl ? url : `https://lostmedia.wdfiles.com/local--files/${page}/${url}`;
            } else {
                console.error('未提供音频URL参数');
                replaceWithError('错误：未提供音频URL');
                return;
            }

            // 错误处理
            audio.addEventListener('error', () => {
                console.error('音频加载失败:', audio.error);
                replaceWithError(audio.error ? `错误：${getErrorText(audio.error.code)}` : '错误：无效的音频URL');
            });

            // 音频元数据加载完成后调整高度
            audio.addEventListener('loadedmetadata', () => {
                // 通知父窗口调整iframe高度
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'audioPlayerResize',
                        height: document.body.scrollHeight
                    }, '*');
                }
            });
        }

        // 替换为错误消息
        function replaceWithError(message) {
            const container = document.querySelector('.audio-container');
            container.innerHTML = `<div class="audio-error">${message}</div>`;
        }

        // 获取错误文本
        function getErrorText(code) {
            const errorMap = {
                1: '用户中止',
                2: '网络错误',
                3: '解码错误',
                4: '不支持的格式'
            };
            return errorMap[code] || '未知错误';
        }

        // 应用自定义样式并初始化播放器
        applyCustomStyles();
        initPlayer();
    </script>
</body>
</html>
