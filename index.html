<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音频播放器</title>
    <style>
        body {margin:0;padding:0;background-color:transparent;}
        .audio-container {width:100%;max-width:400px;margin:0 auto;background-color:#f5f5f5;border-radius:20px;padding:10px;box-sizing:border-box;}
        audio {width:100%;height:auto;border:none;outline:none;}
        .audio-error {color:red;padding:10px;text-align:center;}
    </style>
</head>
<body>
    <div class="audio-container">
        <audio id="dynamicAudio" controls preload="auto"></audio>
    </div>
    <script>
        function getUrlParameter(name) {
            const regex = new RegExp('[?&]'+name+'=([^&#]*)');
            const results = regex.exec(window.location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        const url = getUrlParameter('url');
        const page = getUrlParameter('page') || '%%fullname%%';
        const audio = document.getElementById('dynamicAudio');
        const isFullUrl = /^https?:\/\//i.test(url);
        const timeoutDuration = 10000; // 10秒超时

        let loadTimeout;

        if (url) {
            audio.src = isFullUrl ? url : `https://lostmedia.wdfiles.com/local--files/${page}/${url}`;
            
            // 设置超时计时器
            loadTimeout = setTimeout(() => {
                if (audio.readyState === 0) {
                    handleError('加载超时');
                }
            }, timeoutDuration);

            // 监听加载成功事件
            audio.addEventListener('canplay', () => {
                clearTimeout(loadTimeout);
            });
        } else {
            handleError('未提供音频URL参数');
        }

        // 统一错误处理函数
        function handleError(message) {
            console.error(`音频加载失败: ${message}`);
            audio.outerHTML = `<div class="audio-error">错误：${message}</div>`;
        }

        // 监听各种错误情况
        audio.addEventListener('error', () => {
            clearTimeout(loadTimeout);
            switch(audio.error.code) {
                case audio.error.MEDIA_ERR_ABORTED:
                    handleError('用户中止了加载');
                    break;
                case audio.error.MEDIA_ERR_NETWORK:
                    handleError('网络错误，无法加载音频');
                    break;
                case audio.error.MEDIA_ERR_DECODE:
                    handleError('音频解码失败');
                    break;
                case audio.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
                    handleError('不支持的音频格式');
                    break;
                default:
                    handleError('未知错误');
            }
        });

        // 监听网络状态变化
        window.addEventListener('offline', () => {
            handleError('网络连接已断开');
        });
    </script>
</body>
</html>    
